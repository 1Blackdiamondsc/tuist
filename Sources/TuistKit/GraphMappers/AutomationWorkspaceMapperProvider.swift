import Foundation
import TuistCore
import TuistAutomation
import TuistGenerator

final class AutomationWorkspaceMapperProvider: WorkspaceMapperProviding {
    private let workspaceMapperProvider: WorkspaceMapperProviding
    
    init(
        workspaceMapperProvider: WorkspaceMapperProviding = WorkspaceMapperProvider()
    ) {
        self.workspaceMapperProvider = workspaceMapperProvider
    }
    
    func mapper(config: Config) -> WorkspaceMapping {
        var mappers: [WorkspaceMapping] = []
        mappers.append(AutomationPathWorkspaceMapper())
        mappers.append(workspaceMapperProvider.mapper(config: config))
        if config.generationOptions.contains(.disableAutogeneratedSchemes) {
            mappers.append(AutogeneratedProjectSchemeWorkspaceMapper())
        }
        
        return SequentialWorkspaceMapper(mappers: mappers)
    }
}
